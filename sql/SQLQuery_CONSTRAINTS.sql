--PARA TENERLO TODO BIEN ESTRUCTURADO, PRIMERO CREAMOS LAS TABLAS Y LUEGO AÑADIMOS LAS RESTRICCIONES (SE PUEDE HACER TODO DE UNA VEZ)

CREATE TABLE LOCALIDAD(
COD_LOCALIDAD int NOT NULL,
NOMBRE NVARCHAR (30) NOT NULL)

CREATE TABLE TITULAR(
DNI_TITULAR NVARCHAR(10) NOT NULL,
NOMBRE NVARCHAR(30) NOT NULL,
DOMICILIO NVARCHAR(30),
COD_PUB NVARCHAR(10) NOT NULL)

CREATE TABLE PUB (
COD_PUB NVARCHAR(10) NOT NULL,
NOMBRE NVARCHAR(30) NOT NULL,
LICENCIA_FISCAL NVARCHAR(10) NOT NULL,
DOMICILIO NVARCHAR(30),
FECHA_APERTURA DATE NOT NULL,
HORARIO NVARCHAR(10) NOT NULL,
COD_LOCALIDAD int NOT NULL)

CREATE TABLE EXISTENCIAS(
COD_ARTICULO NVARCHAR(10) NOT NULL,
NOMBRE NVARCHAR(30) NOT NULL,
CANTIDAD int NOT NULL,
PRECIO int NOT NULL,
COD_PUB NVARCHAR(10) NOT NULL)

CREATE TABLE EMPLEADO(
DNI_EMPLEADO NVARCHAR(10) NOT NULL,
NOMBRE NVARCHAR(30) NOT NULL,
DOMICILIO NVARCHAR(30))

CREATE TABLE PUB_EMPLEADO(
COD_PUB NVARCHAR(10) NOT NULL,
DNI_EMPLEADO NVARCHAR(10) NOT NULL,
FUNCION NVARCHAR(10) NOT NULL)

--AÑADIMOS LAS RESTRICCIONES CON ALTER TABLE

ALTER TABLE LOCALIDAD
ADD CONSTRAINT PK_COD_LOCALIDAD PRIMARY KEY (COD_LOCALIDAD)

ALTER TABLE PUB 
ADD CONSTRAINT PK_COD_PUB PRIMARY KEY(COD_PUB),
	CONSTRAINT FK_CODLOCAL_PUB FOREIGN KEY(COD_LOCALIDAD) REFERENCES LOCALIDAD (COD_LOCALIDAD),
	CONSTRAINT CK_HORARIO_PUB CHECK (HORARIO = 'HOR1' OR HORARIO='HOR2'OR HORARIO='HOR3')

ALTER TABLE TITULAR
ADD CONSTRAINT PK_DNI_TITULAR PRIMARY KEY (DNI_TITULAR),
	CONSTRAINT FK_COD_TITULAR FOREIGN KEY (COD_PUB) REFERENCES PUB (COD_PUB)

ALTER TABLE EMPLEADO
ADD CONSTRAINT PK_DNI_EMPLEADO PRIMARY KEY (DNI_EMPLEADO)

ALTER TABLE EXISTENCIAS
ADD CONSTRAINT PK_COD_EXISTENCIAS PRIMARY KEY (COD_ARTICULO),
	CONSTRAINT FK_COD_EXISTENCIAS FOREIGN KEY (COD_PUB) REFERENCES PUB (COD_PUB),
	CONSTRAINT CK_PRECIO_EXISTENCIAS CHECK(PRECIO!=0)
		
ALTER TABLE PUB_EMPLEADO
ADD	CONSTRAINT PK_DNI_PUB_EMPLEADO PRIMARY KEY (DNI_EMPLEADO, COD_PUB, FUNCION),  --CLAVE PRINCIPAL COMPUESTA	
	CONSTRAINT FK_COD_PUB_EMPLEADO FOREIGN KEY(COD_PUB) REFERENCES PUB (COD_PUB),
	CONSTRAINT FK_DNI_PUB_EMPLEADO FOREIGN KEY(DNI_EMPLEADO) REFERENCES EMPLEADO (DNI_EMPLEADO),
	CONSTRAINT CK_FUNCION_PUB_EMPLEADO CHECK (FUNCION='CAMARERO' OR FUNCION='SEGURIDAD' OR FUNCION='LIMPIEZA')

--AÑADIMOS LOS 4 REGISTROS SOLICITADOS (No se puede insertar datos en un pub sin antes haber definido localidad, ni un titular sin haber insertado  los valores de los pubs ). Las existencias deben de crearse después de los pubs. La tabla pub_empleado es la última.

INSERT INTO LOCALIDAD VALUES (01, 'Avilés'),(11, 'Avilés'),(02, 'Gijón'),(03, 'Oviedo')
INSERT INTO PUB VALUES ('PUB01', 'La morsa borracha', 'abc124', 'Avilés', '19960621','HOR1',01), ('PUB02', 'A cholón', 'cdf3e34', 'Avilés', '20050912','HOR2', 01),('PUB03', 'La chuza de la lechuza', 'ghj2234', 'Gijón', '20120301','HOR2', 02), ('PUB04', 'Garrafón Spirits', 'lmn2342', 'Oviedo', '20180217','HOR3', 03)
INSERT INTO TITULAR VALUES ('10895647J', 'Manolo Pérez', 'Avilés', 'PUB01'),('10837647V', 'Juan Pérez', 'Avilés', 'PUB02'),('10328647J', 'Saúl Ramírez', 'Gijón', 'PUB03'),('1089567K', 'Jordi Estadella', 'Oviedo', 'PUB04')
INSERT INTO EXISTENCIAS VALUES ('ART01', 'Whisky Garrafón', 5, 4, 'PUB01'), ('ART02', 'Ron Garrafón', 10, 3, 'PUB01'),('ART03', 'Vodka Garrafón', 5, 7, 'PUB02'),('ART04', 'Tequila Garrafón', 5, 4, 'PUB03'),('ART05', 'Cerveza', 50, 1, 'PUB04')
INSERT INTO EMPLEADO VALUES ('10777544V', 'Antonio David Flores', 'Avilés'),('10874324J', 'Pablo Iglesias', 'Oviedo'),('10123123C', 'Pedro Sánchez', 'Oviedo'),('10775223Z', 'Pablo Casado', 'Gijón')
INSERT INTO PUB_EMPLEADO VALUES('PUB01', '10777544V', 'CAMARERO'),('PUB02', '10874324J', 'LIMPIEZA'),('PUB03', '10123123C', 'CAMARERO'),('PUB04', '10775223Z', 'SEGURIDAD')

